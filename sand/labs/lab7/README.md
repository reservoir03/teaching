# Lab 7

This lab is designed to introduce you to two concepts in unsupervised learning: dimensionality reduction and clustering. The goal is to complete a script that will replicate a (simplified) spike sorting pipeline using spike waveforms from a polytrode recording in rat hippocampus.

Start by downloading the code (.m file) and data (.mat file).

ec014_333_spksort_samp.mat comes from the Buzsaki Lab and [Mizuseki et al. (2009)](http://crcns.org/data-sets/hc/hc-3/about-hc-3). This is a *small* segment of the available data that contains waveforms from 1 animal and 1 shank of a multielectrode array recording.

## Goal

![alt text](https://github.com/stevensonlab/teaching/raw/master/sand/labs/lab7/assets/output.png)

## Part 1: Getting familiar with the data

After loading the data there should be two variables: `Clu` and `X`. `X` contains the waveforms for 17061 spikes recorded from one (8-channel) shank during a recording session. Whenever the signal crossed a threshold, a snippet of 32 samples was recorded on all 8 channels. The samples from each channel are concatenated such that `X` is a [256 x 17061] matrix. `Clu` contains cluster numbers for each spike generated by the spike sorting technique (KlustaKwik) originally used by the Buzsaki Lab.

Start by plotting `X`.

## Part 2: Principal Components Analysis

Use `pca` to reduce the dimensionality of the spike waveforms. Plot the scores for the first 2 pricipal components in a scatter plot. What does the structure in this plot tell you? You can also plot the pricipal components themselves. What does the structure in this plot tell you?

Choosking the number of relevant dimensions is an important consideration in any dimensionality reduction technique. Calculate the variance explained as a function of the number of components. What does this plot tell you?


## Part 3: k-Means Clustering

Now that we have a lower-dimensional representation of the data, we can see if the waveforms "cluster" into separate groups. Use `kmeans` to automatically cluster the scores from PCA (choose k<<256).

Complete the loop in `lab7.m` to plot the first 2 PCs with each cluster in a different color. For comparison, you can also use the `Clu` variable to generate your plot.

## Part 4: Choosing the number of clusters

Choosing the right number of clusters is a key step in any clustering analysis. Call `kmeans` with the `sumd` output and compare the results from several values of `k`.

## Minimal python example

	import scipy.io
	import numpy as np
	import matplotlib.pyplot as plt

	mat = scipy.io.loadmat('ec014_333_spksort_samp.mat')
	X = mat.get('X')
	Clu = mat.get('Clu')

	plt.plot(X[:,0:99]) # plot the first 100 spike waveforms